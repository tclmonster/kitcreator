OBJS_C = kitInit.o pwb.o rechan.o zlib.o
OBJS_ENTRY = main.o winMain.o

all: kit

-include Makefile.common

libkitsh.a: $(OBJS_C) $(EXTRA_OBJS) $(EXTRA_VFS_OBJS)
	$(AR) cr $@ $^

ifeq ($(HAVE_GO),yes)
kit: libkitsh.a $(EXTRA_KIT_DEPS) $(ARCHS)
	cd $(CURDIR)/gokit && \
	CGO_ENABLED=1 \
	CC="$(CC)" \
	$(if $(GOROOT),GOROOT="$(GOROOT)",) \
	CGO_CFLAGS="$(call cgo_iflags,$(filter-out -mwindows,$(CGO_CPPFLAGS) $(CFLAGS))) -I$(CGO_CURDIR)" \
	CGO_LDFLAGS="$(call cgo_abspath,libkitsh.a $(ARCHS)) $(CGO_LDFLAGS_EXTRA)" \
	$(GO) build -buildvcs=false -o $(CURDIR)/kit $(if $(strip $(GO_BUILD_TAGS)),-tags '$(strip $(GO_BUILD_TAGS))',) .
else
kit: $(OBJS_ENTRY) libkitsh.a $(EXTRA_KIT_DEPS) $(ARCHS)
	$(CC) $(CPPFLAGS) $(CFLAGS) -o kit $(OBJS_ENTRY) $(OBJS_C) $(EXTRA_OBJS) $(EXTRA_VFS_OBJS) $(ARCHS) $(LDFLAGS) $(LIBS) $(LDFLAGS_ADD)
endif

$(OBJS_ENTRY):
	$(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $(patsubst %.o,%.c,$@)
